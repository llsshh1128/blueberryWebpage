

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Homework 3 &#8212; Blueberry 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="top" title="Blueberry 1.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Homework" href="../Homework.html" />
    <link rel="next" title="Homework 4" href="hw4.html" />
    <link rel="prev" title="Homework 2" href="hw2.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="hw4.html" title="Homework 4"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hw2.html" title="Homework 2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Blueberry 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Homework.html" accesskey="U">Homework</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="hw2.html"
                        title="previous chapter">Homework 2</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="hw4.html"
                        title="next chapter">Homework 4</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/intro/hw/hw3.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="homework-3">
<span id="hw3"></span><h1>Homework 3<a class="headerlink" href="#homework-3" title="Permalink to this headline">Â¶</a></h1>
<div class="highlight-Fortran"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">!!------------------------------------------------------------------</span>
<span class="c">!! A Fortran example code for approximating pi </span>
<span class="c">!! </span>
<span class="c">!! This code is written by Suhan Liu for AMS 209 HW 3 problem 3</span>
<span class="c">!!</span>
<span class="c">!! * This routine is a driver routine which calls subroutines:</span>
<span class="c">!!   </span>
<span class="c">!!   RootFinder:</span>
<span class="c">!!       |- setup_init (from setup_module)</span>
<span class="c">!!       |</span>
<span class="c">!!       |- pi_summation (from pi_module)</span>
<span class="c">!!       | </span>
<span class="c">!!       |- output_write (from pi_writeOutput)</span>
<span class="c">!!</span>
<span class="c">!!------------------------------------------------------------------</span>


<span class="k">program </span><span class="n">pi_driver</span>

<span class="cp">#include &quot;definition.h&quot;</span>

	<span class="k">use </span><span class="n">setup_module</span><span class="p">,</span>		<span class="n">only</span> <span class="p">:</span> <span class="n">setup_init</span><span class="p">,</span> <span class="n">maxN</span><span class="p">,</span> <span class="n">threshold</span>
	<span class="k">use </span><span class="n">pi_module</span><span class="p">,</span>			<span class="n">only</span> <span class="p">:</span> <span class="n">pi_summation</span>
	<span class="k">use </span><span class="n">pi_writeOutput</span><span class="p">,</span>		<span class="n">only</span> <span class="p">:</span> <span class="n">output_write</span>

	<span class="k">implicit none</span>

	<span class="c">!! local variables</span>
	<span class="kt">integer</span> <span class="kd">::</span> <span class="n">N</span>
	<span class="kt">real</span> 	<span class="kd">::</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pi_new</span><span class="p">,</span> <span class="n">residual</span>

	<span class="c">!! Define allocatable arrays</span>
	<span class="kt">real</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">pi_history</span><span class="p">,</span> <span class="n">res_history</span>

	<span class="n">residual</span> <span class="o">=</span> <span class="mf">1.e8</span>
	<span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">pi</span> <span class="o">=</span> <span class="mf">0.0</span>


	<span class="c">!! Call setup_init to initialize the runtime parameters</span>
	<span class="k">call </span><span class="n">setup_init</span><span class="p">()</span>

	<span class="k">allocate</span><span class="p">(</span> <span class="n">pi_history</span><span class="p">(</span><span class="n">maxN</span><span class="p">))</span>
	<span class="k">allocate</span><span class="p">(</span><span class="n">res_history</span><span class="p">(</span><span class="n">maxN</span><span class="p">))</span>

	<span class="k">do while</span> <span class="p">(</span><span class="n">residual</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="n">maxN</span><span class="p">)</span>
		<span class="k">call </span><span class="n">pi_summation</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi_new</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">residual</span><span class="p">)</span>

		<span class="n">pi_history</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pi_new</span>
		<span class="n">res_history</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">residual</span>

		<span class="n">pi</span> <span class="o">=</span> <span class="n">pi_new</span>
		<span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="k">end do</span>

	<span class="c">!! Prepare to report outputs:</span>
	<span class="c">!! (a) Short summary onto the screen</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">N</span> <span class="o">&lt;</span> <span class="n">maxN</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">residual</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">))</span> <span class="k">then</span>
<span class="k">		print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;             Solution Convergence Summary                          &#39;</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Your converged solution x = &#39;</span><span class="p">,</span> <span class="n">pi</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Solution converged when N = &#39;</span><span class="p">,</span> <span class="n">N</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Threshold value = &#39;</span><span class="p">,</span> <span class="n">threshold</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Residual value = &#39;</span><span class="p">,</span> <span class="n">residual</span>
		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&#39;</span>
  	<span class="k">end if</span>

<span class="k">	call </span><span class="n">output_write</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">pi_history</span><span class="p">,</span> <span class="n">res_history</span><span class="p">)</span>

	<span class="k">deallocate</span><span class="p">(</span><span class="n">pi_history</span><span class="p">)</span>
	<span class="k">deallocate</span><span class="p">(</span><span class="n">res_history</span><span class="p">)</span>

<span class="k">end program </span><span class="n">pi_driver</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-Fortran"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">!!------------------------------------------------------------------</span>
<span class="c">!! A Fortran example code for approximating pi </span>
<span class="c">!! </span>
<span class="c">!! This code is written by Suhan Liu for AMS 209 HW 3 problem 3</span>
<span class="c">!! </span>
<span class="c">!! This module has one subroutine which use summation to approximate</span>
<span class="c">!! pi</span>
<span class="c">!!------------------------------------------------------------------</span>


<span class="k">module </span><span class="n">pi_module</span>

<span class="cp">#include &quot;definition.h&quot;</span>

	<span class="k">use </span><span class="n">setup_module</span>

<span class="k">contains</span>

<span class="k">	subroutine </span><span class="n">pi_summation</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi_new</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">residual</span><span class="p">)</span>

		<span class="k">implicit none</span>
<span class="k">		</span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">N</span>
		<span class="kt">real</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  	<span class="kd">::</span> <span class="n">pi</span>
		<span class="kt">real</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">pi_new</span><span class="p">,</span> <span class="n">residual</span>

		<span class="n">pi_new</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="mf">6.</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.</span><span class="o">/</span><span class="p">(</span><span class="mf">8.</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">8.</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mf">4.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">8.</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mf">5.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">8.</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mf">6.</span><span class="p">))</span>
		<span class="n">residual</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pi_new</span> <span class="o">-</span> <span class="n">pi_trueValue</span><span class="p">)</span>
	<span class="k">end subroutine </span><span class="n">pi_summation</span>

<span class="k">end module </span><span class="n">pi_module</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-Fortran"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">!!------------------------------------------------------------------</span>
<span class="c">!! A Fortran example code for approximating pi </span>
<span class="c">!! </span>
<span class="c">!! This code is written by Suhan Liu for AMS 209 HW 3 problem 3</span>
<span class="c">!!</span>
<span class="c">!! This module has one subroutine which writes an output </span>
<span class="c">!! to a data file named &quot;pi_approx.dat&quot;</span>
<span class="c">!!</span>
<span class="c">!!------------------------------------------------------------------</span>


<span class="k">module </span><span class="n">pi_writeOutput</span>

	<span class="k">implicit none</span>

<span class="k">contains</span>

<span class="k">	subroutine </span><span class="n">output_write</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">residual</span><span class="p">)</span>

		<span class="k">implicit none</span>

<span class="k">		</span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 		   	<span class="kd">::</span> <span class="n">length</span>
		<span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">pi</span><span class="p">,</span> <span class="n">residual</span>
    	<span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
    	<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ofile</span>

    	<span class="c">!! File name for ascii output</span>
    	<span class="n">ofile</span> <span class="o">=</span> <span class="s1">&#39;pi_approx.dat&#39;</span>

    	<span class="c">!! File open</span>
    	<span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
    
    	<span class="c">!! Write into a file:</span>
    	<span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">length</span>
       		<span class="k">write</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">920</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">pi</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">residual</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    	<span class="k">end do</span>

    	<span class="c">!! Output format specifiers</span>
<span class="mi">920</span> <span class="k">format</span><span class="p">(</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span> <span class="n">i5</span><span class="p">,</span> <span class="n">f20</span><span class="p">.</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="n">x</span><span class="p">,</span> <span class="n">f20</span><span class="p">.</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="n">x</span><span class="p">,</span> <span class="n">f20</span><span class="p">.</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="c">!! File close</span>
    <span class="k">close</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

  	<span class="k">end subroutine </span><span class="n">output_write</span>
  
<span class="k">end module </span><span class="n">pi_writeOutput</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-Fortran"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">!!------------------------------------------------------------------</span>
<span class="c">!! A Fortran example code for finding a root of a user-defined </span>
<span class="c">!! function f(x) = 0.</span>
<span class="c">!! </span>
<span class="c">!! This code is written by Prof. Dongwook Lee for AMS 209.</span>
<span class="c">!!</span>
<span class="c">!! This module has four subroutines which can read in various</span>
<span class="c">!! types of runtime parameter values (real, integer, logical, and character)</span>
<span class="c">!! from a user-defined runtime parameter file, &#39;rootFinder.init&#39;</span>
<span class="c">!!</span>
<span class="c">!!------------------------------------------------------------------</span>

<span class="k">module </span><span class="n">read_initFile_module</span>

<span class="cp">#include &quot;definition.h&quot;</span>
  
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">fileLen</span><span class="o">=</span><span class="mi">50</span>

<span class="k">contains</span>

<span class="k">subroutine </span><span class="n">read_initFileReal</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">varName</span><span class="p">,</span><span class="n">varValue</span><span class="p">)</span>

  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fileName</span><span class="p">,</span><span class="n">varName</span>
  <span class="kt">real</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">varValue</span>

  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">openStatus</span><span class="p">,</span><span class="n">inputStatus</span>
  <span class="kt">real</span> <span class="kd">::</span> <span class="n">simInitVars</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">simCharVars</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span>

  <span class="k">open</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">IOSTAT</span><span class="o">=</span><span class="n">openStatus</span><span class="p">,</span><span class="n">FORM</span><span class="o">=</span><span class="s1">&#39;FORMATTED&#39;</span><span class="p">,</span><span class="n">ACTION</span><span class="o">=</span><span class="s1">&#39;READ&#39;</span><span class="p">)</span>

  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fileLen</span>
     <span class="k">read</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">FMT</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">IOSTAT</span><span class="o">=</span><span class="n">inputStatus</span><span class="p">)</span> <span class="n">simCharVars</span>
     <span class="n">pos1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">,</span><span class="n">varName</span><span class="p">)</span>
     <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos1</span><span class="o">+</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">pos2</span> <span class="o">&gt;</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        read</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">(</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span><span class="o">*</span><span class="p">)</span><span class="n">simInitVars</span>
        <span class="n">varValue</span> <span class="o">=</span> <span class="n">simInitVars</span>
        <span class="c">!exit</span>
     <span class="n">endif</span>
  <span class="k">end do</span>

<span class="k">  close</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="mi">100</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span> <span class="n">F3</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>

<span class="k">end subroutine </span><span class="n">read_initFileReal</span>



<span class="k">subroutine </span><span class="n">read_initFileInt</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">varName</span><span class="p">,</span><span class="n">varValue</span><span class="p">)</span>

  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fileName</span><span class="p">,</span><span class="n">varName</span>
  <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">varValue</span>

  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">openStatus</span><span class="p">,</span><span class="n">inputStatus</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">simInitVars</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">simCharVars</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span>

  <span class="k">open</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">IOSTAT</span><span class="o">=</span><span class="n">openStatus</span><span class="p">,</span><span class="n">FORM</span><span class="o">=</span><span class="s1">&#39;FORMATTED&#39;</span><span class="p">,</span><span class="n">ACTION</span><span class="o">=</span><span class="s1">&#39;READ&#39;</span><span class="p">)</span>
  
  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fileLen</span>
     <span class="k">read</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">FMT</span> <span class="o">=</span> <span class="mi">101</span><span class="p">,</span> <span class="n">IOSTAT</span><span class="o">=</span><span class="n">inputStatus</span><span class="p">)</span> <span class="n">simCharVars</span><span class="c">!;print*,i,simCharVars</span>
     <span class="n">pos1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">,</span><span class="n">varName</span><span class="p">)</span><span class="c">!;print*,pos1</span>
     <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos1</span><span class="o">+</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span><span class="c">!;print*,pos2,len_trim(varName)</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">pos2</span> <span class="o">&gt;</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        read</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">(</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span><span class="o">*</span><span class="p">)</span><span class="n">simInitVars</span><span class="c">!;print*,simInitVars</span>
        <span class="n">varValue</span> <span class="o">=</span> <span class="n">simInitVars</span><span class="c">!;print*,varValue</span>
        <span class="k">exit</span>
<span class="k">     </span><span class="n">endif</span>
  <span class="k">end do</span>
<span class="k">  </span>
<span class="k">  close</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="mi">101</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span> <span class="n">I5</span><span class="p">)</span>

<span class="k">end subroutine </span><span class="n">read_initFileInt</span>


<span class="k">subroutine </span><span class="n">read_initFileBool</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">varName</span><span class="p">,</span><span class="n">varValue</span><span class="p">)</span>

  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fileName</span><span class="p">,</span><span class="n">varName</span>
  <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">varValue</span>

  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">openStatus</span><span class="p">,</span><span class="n">inputStatus</span>
  <span class="kt">logical</span> <span class="kd">::</span> <span class="n">simInitVars</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">simCharVars</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span>

  <span class="k">open</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">IOSTAT</span><span class="o">=</span><span class="n">openStatus</span><span class="p">,</span><span class="n">FORM</span><span class="o">=</span><span class="s1">&#39;FORMATTED&#39;</span><span class="p">,</span><span class="n">ACTION</span><span class="o">=</span><span class="s1">&#39;READ&#39;</span><span class="p">)</span>
  
  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fileLen</span>
     <span class="k">read</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">FMT</span> <span class="o">=</span> <span class="mi">102</span><span class="p">,</span> <span class="n">IOSTAT</span><span class="o">=</span><span class="n">inputStatus</span><span class="p">)</span> <span class="n">simCharVars</span>
     <span class="n">pos1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">,</span><span class="n">varName</span><span class="p">)</span>
     <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos1</span><span class="o">+</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>

     <span class="k">if</span> <span class="p">(</span><span class="n">pos2</span> <span class="o">&gt;</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        read</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">(</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span><span class="o">*</span><span class="p">)</span><span class="n">simInitVars</span>
        <span class="n">varValue</span> <span class="o">=</span> <span class="n">simInitVars</span>
        <span class="c">!exit</span>
     <span class="n">endif</span>
  <span class="k">end do</span>

<span class="k">  close</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="mi">102</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

<span class="k">end subroutine </span><span class="n">read_initFileBool</span>




<span class="k">subroutine </span><span class="n">read_initFileChar</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">varName</span><span class="p">,</span><span class="n">varValue</span><span class="p">)</span>

  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fileName</span><span class="p">,</span><span class="n">varName</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">varValue</span>

  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">openStatus</span><span class="p">,</span><span class="n">inputStatus</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">simInitVars</span>
  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">simCharVars</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span>

  <span class="k">open</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">IOSTAT</span><span class="o">=</span><span class="n">openStatus</span><span class="p">,</span><span class="n">FORM</span><span class="o">=</span><span class="s1">&#39;FORMATTED&#39;</span><span class="p">,</span><span class="n">ACTION</span><span class="o">=</span><span class="s1">&#39;READ&#39;</span><span class="p">)</span>
  
  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fileLen</span>
     <span class="k">read</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">FMT</span> <span class="o">=</span> <span class="mi">103</span><span class="p">,</span> <span class="n">IOSTAT</span><span class="o">=</span><span class="n">inputStatus</span><span class="p">)</span> <span class="n">simCharVars</span>
     <span class="n">pos1</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">,</span><span class="n">varName</span><span class="p">)</span>
     <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos1</span><span class="o">+</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>

     <span class="k">if</span> <span class="p">(</span><span class="n">pos2</span> <span class="o">&gt;</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">varName</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        read</span><span class="p">(</span><span class="n">simCharVars</span><span class="p">(</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span><span class="o">*</span><span class="p">)</span><span class="n">simInitVars</span>
        <span class="n">varValue</span> <span class="o">=</span> <span class="n">simInitVars</span>
        <span class="c">!exit</span>
     <span class="n">endif</span>
  <span class="k">end do</span>

<span class="k">  close</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>

<span class="mi">103</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="k">end subroutine </span><span class="n">read_initFileChar</span>

<span class="k">end module </span><span class="n">read_initFile_module</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-Fortran"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">!!------------------------------------------------------------------</span>
<span class="c">!! A Fortran example code for approximating pi </span>
<span class="c">!! </span>
<span class="c">!! This code is written by Suhan Liu for AMS 209 HW 3 problem 3</span>
<span class="c">!!</span>
<span class="c">!! This module has one subroutine which initialize your setup</span>
<span class="c">!! by reading in runtime parameters from &#39;pi_approx.init&#39; file.</span>
<span class="c">!! The setup_init subroutine calls read_initFile*** subroutines</span>
<span class="c">!! that are implemented by Prof. Dongwook Lee as subroutines in </span>
<span class="c">!! read_initFile_module. </span>
<span class="c">!!</span>
<span class="c">!!------------------------------------------------------------------</span>

<span class="k">module </span><span class="n">setup_module</span>

<span class="cp">#include &quot;definition.h&quot;</span>

	<span class="k">use </span><span class="n">read_initFile_module</span>

	<span class="k">implicit none</span>

<span class="k">	</span><span class="kt">integer</span><span class="p">,</span> <span class="k">save</span> <span class="kd">::</span> <span class="n">maxN</span>
	<span class="kt">real</span><span class="p">,</span> <span class="k">save</span>    <span class="kd">::</span> <span class="n">threshold</span>


<span class="k">contains</span>

<span class="k">	subroutine </span><span class="n">setup_init</span><span class="p">()</span>

		<span class="k">implicit none</span>

<span class="k">		call </span><span class="n">read_initFileInt</span><span class="p">(</span><span class="s1">&#39;pi_approx.init&#39;</span><span class="p">,</span> <span class="s1">&#39;maxN&#39;</span><span class="p">,</span> <span class="n">maxN</span><span class="p">)</span>
		<span class="k">call </span><span class="n">read_initFileReal</span><span class="p">(</span><span class="s1">&#39;pi_approx.init&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>


		<span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;The following are runtime parameters: &#39;</span>
	    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;======================================&#39;</span>
	    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;	  Max N: &#39;</span><span class="p">,</span> <span class="n">maxN</span>
	    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Threshold: &#39;</span><span class="p">,</span> <span class="n">threshold</span>
	    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;======================================&#39;</span>

	<span class="k">end subroutine </span><span class="n">setup_init</span>

<span class="k">end module </span><span class="n">setup_module</span>
</pre></div>
</td></tr></table></div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="hw4.html" title="Homework 4"
             >next</a> |</li>
        <li class="right" >
          <a href="hw2.html" title="Homework 2"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Blueberry 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Homework.html" >Homework</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Suhan Liu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>